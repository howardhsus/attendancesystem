<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°åŒ—101å¤§æ¨“æ‰“å¡ç³»çµ±</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error-box {
            background: #fdecea;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        .success-box {
            background: #e8f8f0;
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        button {
            background: #06c755;
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 5px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
        }
        button:disabled {
            background: #ddd;
        }
        .location-status {
            padding: 15px;
            background: #ebf5fb;
            border-radius: 5px;
            margin: 15px 0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å°åŒ—101å¤§æ¨“æ‰“å¡ç³»çµ±</h1>
        
        <!-- ç‹€æ…‹é¡¯ç¤ºå€ -->
        <div id="errorBox" class="error-box hidden">
            <h3>âš ï¸ æ‰“å¡å¤±æ•—</h3>
            <p id="errorMessage"></p>
            <p><strong>å»ºè­°æ“ä½œï¼š</strong></p>
            <ol>
                <li>ç¢ºèªç¶²è·¯é€£ç·šæ­£å¸¸</li>
                <li>é‡æ–°æ•´ç†é é¢å¾Œå†è©¦</li>
                <li>æª¢æŸ¥ç¶²å€åˆ—æ˜¯å¦ç‚º <code>https://liff.line.me/...</code></li>
            </ol>
        </div>
        
        <div id="successBox" class="success-box hidden">
            <h3>âœ… æ‰“å¡æˆåŠŸ</h3>
            <p id="successMessage"></p>
        </div>
        
        <!-- æ‰“å¡è¡¨å–® -->
        <div class="location-status">
            <p id="locationText">æ­£åœ¨æº–å‚™å®šä½ç³»çµ±...</p>
            <p id="distanceText"></p>
        </div>
        
        <button id="checkInBtn" disabled>ä¸Šç­æ‰“å¡</button>
        <button id="checkOutBtn" disabled>ä¸‹ç­æ‰“å¡</button>
        
        <div id="troubleshootTip" class="hidden">
            <h3>â„¹ï¸ æŠ€è¡“æç¤º</h3>
            <p>å¦‚æŒçºŒé‡åˆ°å•é¡Œï¼Œå¯èƒ½æ˜¯ä»¥ä¸‹åŸå› ï¼š</p>
            <ul>
                <li>LINE ä¼ºæœå™¨æš«æ™‚ç¹å¿™ï¼ˆè«‹ç¨å¾Œå†è©¦ï¼‰</li>
                <li>æ‚¨çš„ç¶²è·¯ç’°å¢ƒé™åˆ¶ï¼ˆå˜—è©¦åˆ‡æ›ç¶²è·¯ï¼‰</li>
            </ul>
        </div>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        // ç‹€æ…‹ç®¡ç†
        const state = {
            isInTaipei101: false,
            lastCheckTime: null
        };

        // DOM å…ƒç´ 
        const elements = {
            errorBox: document.getElementById('errorBox'),
            errorMessage: document.getElementById('errorMessage'),
            successBox: document.getElementById('successBox'),
            successMessage: document.getElementById('successMessage'),
            locationText: document.getElementById('locationText'),
            distanceText: document.getElementById('distanceText'),
            checkInBtn: document.getElementById('checkInBtn'),
            checkOutBtn: document.getElementById('checkOutBtn'),
            troubleshootTip: document.getElementById('troubleshootTip')
        };

        // åˆå§‹åŒ–
        async function init() {
            try {
                await liff.init({ liffId: '2007700262-da76ZbYE' });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }
                
                // æ¨¡æ“¬ä½ç½®æª¢æŸ¥ï¼ˆå¯¦éš›æ‡‰ä½¿ç”¨ç€è¦½å™¨Geolocationï¼‰
                checkLocation();
                
            } catch (error) {
                showError('LIFFåˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é—œé–‰å¾Œé‡æ–°é€²å…¥');
                console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
            }
        }

        // ä½ç½®æª¢æŸ¥ï¼ˆç´”å‰ç«¯æ¨¡æ“¬ï¼‰
        function checkLocation() {
            elements.locationText.textContent = "å®šä½ä¸­...";
            
            // æ¨¡æ“¬å»¶é²
            setTimeout(() => {
                // éš¨æ©Ÿæ¨¡æ“¬ä½ç½®çµæœï¼ˆé–‹ç™¼ç”¨ï¼‰
                const isInRange = Math.random() > 0.3; // 70% æ©Ÿç‡åœ¨ç¯„åœå…§
                
                if (isInRange) {
                    state.isInTaipei101 = true;
                    elements.locationText.textContent = "ğŸ“ ä½ç½®ï¼šå°åŒ—101å¤§æ¨“ç¯„åœå…§";
                    elements.distanceText.textContent = "è·é›¢ï¼šç´„50å…¬å°º";
                    enableButtons();
                } else {
                    state.isInTaipei101 = false;
                    elements.locationText.textContent = "âš ï¸ æ‚¨ä¸åœ¨å°åŒ—101å¤§æ¨“ç¯„åœå…§";
                    elements.distanceText.textContent = "è«‹ç§»å‹•è‡³å°åŒ—101å¤§æ¨“å¾Œé‡è©¦";
                    disableButtons();
                }
            }, 1500);
        }

        // æ‰“å¡è™•ç†ï¼ˆç´”å‰ç«¯æ¨¡æ“¬ï¼‰
        function setupCheckInButtons() {
            elements.checkInBtn.addEventListener('click', () => {
                simulateCheckIn('checkIn');
            });
            
            elements.checkOutBtn.addEventListener('click', () => {
                simulateCheckIn('checkOut');
            });
        }

        // æ¨¡æ“¬æ‰“å¡ï¼ˆåƒ…å‰ç«¯é¡¯ç¤ºï¼‰
        function simulateCheckIn(type) {
            disableButtons();
            
            // æ¨¡æ“¬APIå‘¼å«å»¶é²
            setTimeout(() => {
                // éš¨æ©Ÿæ¨¡æ“¬æˆåŠŸ/å¤±æ•—ï¼ˆé–‹ç™¼ç”¨ï¼‰
                const isSuccess = Math.random() > 0.3; // 70% æˆåŠŸæ©Ÿç‡
                
                if (isSuccess) {
                    const time = new Date().toLocaleTimeString('zh-TW');
                    showSuccess(`${type === 'checkIn' ? 'ä¸Šç­' : 'ä¸‹ç­'}æ‰“å¡æˆåŠŸ (${time})`);
                    state.lastCheckTime = new Date();
                } else {
                    showError('æ‰“å¡å¤±æ•—ï¼šé€£ç·šç•°å¸¸ (æ¨¡æ“¬éŒ¯èª¤)');
                    elements.troubleshootTip.classList.remove('hidden');
                }
                
                enableButtons();
            }, 2000);
        }

        // UI æ§åˆ¶å‡½æ•¸
        function showError(message) {
            elements.errorMessage.textContent = message;
            elements.errorBox.classList.remove('hidden');
            elements.successBox.classList.add('hidden');
        }

        function showSuccess(message) {
            elements.successMessage.textContent = message;
            elements.successBox.classList.remove('hidden');
            elements.errorBox.classList.add('hidden');
        }

        function enableButtons() {
            if (state.isInTaipei101) {
                elements.checkInBtn.disabled = false;
                elements.checkOutBtn.disabled = false;
            }
        }

        function disableButtons() {
            elements.checkInBtn.disabled = true;
            elements.checkOutBtn.disabled = true;
        }

        // å•Ÿå‹•æ‡‰ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            init();
            setupCheckInButtons();
        });
    </script>
</body>
</html>
